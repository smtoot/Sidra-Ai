generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id        String      @id
  payload   Json?
  actorId   String
  targetId  String?
  createdAt DateTime    @default(now())
  action    AuditAction
  users     users       @relation(fields: [actorId], references: [id])

  @@index([action])
  @@index([actorId])
}

model availability {
  id               String           @id
  teacherId        String
  dayOfWeek        DayOfWeek
  startTime        String
  endTime          String
  isRecurring      Boolean          @default(true)
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
}

model availability_exceptions {
  id               String           @id
  teacherId        String
  startDate        DateTime
  endDate          DateTime
  type             ExceptionType    @default(ALL_DAY)
  startTime        String?
  endTime          String?
  reason           String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
}

model bank_info {
  id                String           @id
  teacherId         String           @unique
  bankName          String
  accountNumber     String
  accountHolderName String
  iban              String?
  swiftCode         String?
  bankBranch        String?
  teacher_profiles  teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)
}

model bookings {
  id                                   String                @id
  bookedByUserId                       String
  beneficiaryType                      BeneficiaryType
  childId                              String?
  studentUserId                        String?
  teacherId                            String
  subjectId                            String
  startTime                            DateTime
  endTime                              DateTime
  meetingLink                          String?
  price                                Decimal               @db.Decimal(10, 2)
  commissionRate                       Decimal               @default(0.18) @db.Decimal(5, 2)
  status                               BookingStatus         @default(PENDING_TEACHER_APPROVAL)
  cancelReason                         String?
  createdAt                            DateTime              @default(now())
  updatedAt                            DateTime
  autoReleaseAt                        DateTime?
  cancellationPolicySnapshot           String?
  cancelledAt                          DateTime?
  cancelledBy                          String?
  paymentReleasedAt                    DateTime?
  refundAmount                         Decimal?              @db.Decimal(10, 2)
  refundPercent                        Decimal?              @db.Decimal(5, 2)
  reminderSentAt                       DateTime?
  studentConfirmedAt                   DateTime?
  teacherCompAmount                    Decimal?              @db.Decimal(10, 2)
  teacherCompletedAt                   DateTime?
  timezone                             String?
  disputeReminderSentAt                DateTime?
  disputeWindowClosesAt                DateTime?
  disputeWindowOpensAt                 DateTime?
  meetingLinkReminderSentAt            DateTime?
  additionalNotes                      String?
  bookingNotes                         String?
  homeworkAssigned                     Boolean?
  homeworkDescription                  String?
  lastRescheduledAt                    DateTime?
  maxReschedules                       Int                   @default(2)
  nextSessionRecommendations           String?
  originalScheduledAt                  DateTime?
  packageSessionType                   PackageSessionType?
  paymentDeadline                      DateTime?
  paymentLockedAt                      DateTime?
  pendingTierId                        String?
  readableId                           String?               @unique
  rescheduleCount                      Int                   @default(0)
  rescheduledByRole                    String?
  sessionProofUrl                      String?
  studentPerformanceNotes              String?
  studentPerformanceRating             Int?
  teacherPrepNotes                     String?
  teacherSummary                       String?
  topicsCovered                        String?
  sessionReminderSentAt                DateTime?
  users_bookings_bookedByUserIdTousers users                 @relation("bookings_bookedByUserIdTousers", fields: [bookedByUserId], references: [id])
  children                             children?             @relation(fields: [childId], references: [id])
  users_bookings_studentUserIdTousers  users?                @relation("bookings_studentUserIdTousers", fields: [studentUserId], references: [id])
  subjects                             subjects              @relation(fields: [subjectId], references: [id])
  teacher_profiles                     teacher_profiles      @relation(fields: [teacherId], references: [id])
  disputes                             disputes?
  package_redemptions                  package_redemptions?
  ratings                              ratings?
  reschedule_requests                  reschedule_requests[]
  support_tickets                      support_tickets[]

  @@unique([teacherId, startTime])
  @@index([autoReleaseAt])
  @@index([beneficiaryType])
  @@index([bookedByUserId])
  @@index([paymentReleasedAt])
  @@index([startTime])
  @@index([status])
}

model children {
  id              String          @id
  parentId        String
  name            String
  gradeLevel      String?
  schoolName      String?
  curriculumId    String?
  bookings        bookings[]
  curricula       curricula?      @relation(fields: [curriculumId], references: [id])
  parent_profiles parent_profiles @relation(fields: [parentId], references: [id])

  @@index([parentId])
}

model curricula {
  id                  String                @id
  nameAr              String
  nameEn              String
  isActive            Boolean               @default(true)
  code                String                @unique
  systemType          SystemType            @default(NATIONAL)
  children            children[]
  curriculum_subjects curriculum_subjects[]
  educational_stages  educational_stages[]
  student_profiles    student_profiles[]
  teacher_subjects    teacher_subjects[]
}

model curriculum_subjects {
  curriculumId String
  subjectId    String
  curricula    curricula @relation(fields: [curriculumId], references: [id])
  subjects     subjects  @relation(fields: [subjectId], references: [id])

  @@id([curriculumId, subjectId])
}

model demo_sessions {
  id               String           @id
  demoOwnerId      String
  demoOwnerType    DemoOwnerType
  beneficiaryId    String?
  teacherId        String
  status           DemoStatus       @default(SCHEDULED)
  usedAt           DateTime?
  cancelledAt      DateTime?
  rescheduleCount  Int              @default(0)
  createdAt        DateTime         @default(now())
  users            users            @relation(fields: [demoOwnerId], references: [id])
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id])

  @@unique([demoOwnerId, teacherId])
  @@index([demoOwnerId, status])
}

model disputes {
  id                                      String           @id
  bookingId                               String           @unique
  raisedByUserId                          String
  type                                    DisputeType
  description                             String
  evidence                                String[]
  status                                  DisputeStatus    @default(PENDING)
  resolvedByAdminId                       String?
  resolution                              String?
  teacherPayout                           Decimal?         @db.Decimal(10, 2)
  studentRefund                           Decimal?         @db.Decimal(10, 2)
  createdAt                               DateTime         @default(now())
  resolvedAt                              DateTime?
  supportTicketId                         String?          @unique
  bookings                                bookings         @relation(fields: [bookingId], references: [id])
  users_disputes_raisedByUserIdTousers    users            @relation("disputes_raisedByUserIdTousers", fields: [raisedByUserId], references: [id])
  users_disputes_resolvedByAdminIdTousers users?           @relation("disputes_resolvedByAdminIdTousers", fields: [resolvedByAdminId], references: [id])
  support_tickets                         support_tickets? @relation(fields: [supportTicketId], references: [id])

  @@index([bookingId])
  @@index([status])
}

model documents {
  id               String           @id
  teacherId        String
  type             DocumentType
  fileName         String
  fileUrl          String
  uploadedAt       DateTime         @default(now())
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)
}

model educational_stages {
  id           String         @id
  curriculumId String
  nameAr       String
  nameEn       String
  sequence     Int
  isActive     Boolean        @default(true)
  curricula    curricula      @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  grade_levels grade_levels[]
}

model email_outbox {
  id           String      @id
  to           String
  subject      String
  templateId   String
  payload      Json
  status       EmailStatus @default(PENDING)
  attempts     Int         @default(0)
  lastAttempt  DateTime?
  nextRetryAt  DateTime?
  sentAt       DateTime?
  errorMessage String?
  createdAt    DateTime    @default(now())

  @@index([status, nextRetryAt])
}

model grade_levels {
  id                     String                   @id
  stageId                String
  nameAr                 String
  nameEn                 String
  code                   String
  sequence               Int
  isActive               Boolean                  @default(true)
  educational_stages     educational_stages       @relation(fields: [stageId], references: [id], onDelete: Cascade)
  teacher_subject_grades teacher_subject_grades[]

  @@unique([stageId, code])
}

model interview_time_slots {
  id               String           @id
  teacherProfileId String
  proposedDateTime DateTime
  meetingLink      String?
  isSelected       Boolean          @default(false)
  createdAt        DateTime         @default(now())
  teacher_profiles teacher_profiles @relation(fields: [teacherProfileId], references: [id], onDelete: Cascade)
}

model ledger_audit_logs {
  id               String    @id
  runAt            DateTime  @default(now())
  totalWallets     Int
  walletsChecked   Int
  discrepancyCount Int       @default(0)
  status           String
  durationMs       Int
  details          Json?
  resolvedAt       DateTime?
  resolvedByUserId String?
  resolutionNote   String?

  @@index([runAt])
  @@index([status])
}

model notifications {
  id         String             @id
  userId     String
  title      String
  message    String
  type       NotificationType
  status     NotificationStatus @default(UNREAD)
  link       String?
  metadata   Json?
  dedupeKey  String?            @unique
  readAt     DateTime?
  archivedAt DateTime?
  expiresAt  DateTime?
  createdAt  DateTime           @default(now())
  users      users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([userId, status, createdAt])
}

model package_redemptions {
  id               String           @id
  packageId        String
  bookingId        String           @unique
  status           RedemptionStatus @default(RESERVED)
  releasedAt       DateTime?
  createdAt        DateTime         @default(now())
  bookings         bookings         @relation(fields: [bookingId], references: [id])
  student_packages student_packages @relation(fields: [packageId], references: [id])

  @@index([packageId, status])
}

model package_tiers {
  id                            String                          @id
  sessionCount                  Int
  discountPercent               Decimal                         @db.Decimal(5, 2)
  isActive                      Boolean                         @default(true)
  displayOrder                  Int                             @default(0)
  recurringRatio                Decimal                         @default(0.8) @db.Decimal(3, 2)
  floatingRatio                 Decimal                         @default(0.2) @db.Decimal(3, 2)
  rescheduleLimit               Int                             @default(2)
  durationWeeks                 Int
  gracePeriodDays               Int                             @default(14)
  nameAr                        String?
  nameEn                        String?
  descriptionAr                 String?
  descriptionEn                 String?
  isFeatured                    Boolean                         @default(false)
  badge                         String?
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime
  student_packages              student_packages[]
  teacher_package_tier_settings teacher_package_tier_settings[]
}

model package_transactions {
  id               String           @id
  idempotencyKey   String           @unique
  type             String
  packageId        String
  amount           Decimal          @db.Decimal(10, 2)
  createdAt        DateTime         @default(now())
  student_packages student_packages @relation(fields: [packageId], references: [id])

  @@index([packageId])
}

model parent_profiles {
  id             String     @id
  userId         String     @unique
  city           String?
  country        String?
  whatsappNumber String?
  children       children[]
  users          users      @relation(fields: [userId], references: [id])
}

model ratings {
  id               String           @id
  bookingId        String?          @unique
  teacherId        String
  ratedByUserId    String
  score            Int
  comment          String?
  isVisible        Boolean          @default(true)
  createdAt        DateTime         @default(now())
  bookings         bookings?        @relation(fields: [bookingId], references: [id])
  users            users            @relation(fields: [ratedByUserId], references: [id])
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([isVisible])
  @@index([ratedByUserId])
  @@index([teacherId])
}

model readable_id_counters {
  id        String   @id
  type      String
  yearMonth String?
  counter   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([type, yearMonth])
}

model refresh_tokens {
  id              String    @id
  userId          String
  tokenHash       String
  expiresAt       DateTime
  createdAt       DateTime  @default(now())
  revoked         Boolean   @default(false)
  revokedAt       DateTime?
  replacedByToken String?
  deviceInfo      String?
  users           users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tokenHash])
  @@index([userId])
}

model reschedule_requests {
  id                                             String                  @id
  bookingId                                      String
  requestedById                                  String
  proposedStartTime                              DateTime?
  proposedEndTime                                DateTime?
  reason                                         String
  status                                         RescheduleRequestStatus @default(PENDING)
  respondedAt                                    DateTime?
  respondedById                                  String?
  createdAt                                      DateTime                @default(now())
  expiresAt                                      DateTime
  bookings                                       bookings                @relation(fields: [bookingId], references: [id])
  users_reschedule_requests_requestedByIdTousers users                   @relation("reschedule_requests_requestedByIdTousers", fields: [requestedById], references: [id])
  users_reschedule_requests_respondedByIdTousers users?                  @relation("reschedule_requests_respondedByIdTousers", fields: [respondedById], references: [id])

  @@index([bookingId])
  @@index([status])
}

model saved_teachers {
  id               String           @id
  userId           String
  teacherId        String
  createdAt        DateTime         @default(now())
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  users            users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, teacherId])
}

model student_packages {
  id                                      String                 @id
  readableId                              String?                @unique
  payerId                                 String
  studentId                               String
  teacherId                               String
  subjectId                               String
  tierId                                  String?
  sessionCount                            Int
  sessionsUsed                            Int                    @default(0)
  originalPricePerSession                 Decimal                @db.Decimal(10, 2)
  discountedPricePerSession               Decimal                @db.Decimal(10, 2)
  perSessionReleaseAmount                 Decimal                @db.Decimal(10, 2)
  totalPaid                               Decimal                @db.Decimal(10, 2)
  escrowRemaining                         Decimal                @db.Decimal(10, 2)
  status                                  PackageStatus          @default(ACTIVE)
  purchasedAt                             DateTime               @default(now())
  expiresAt                               DateTime
  isSmartPack                             Boolean                @default(true)
  recurringWeekday                        String?
  recurringTime                           String?
  recurringSessionCount                   Int?
  floatingSessionCount                    Int?
  floatingSessionsUsed                    Int                    @default(0)
  rescheduleLimit                         Int                    @default(2)
  firstScheduledSession                   DateTime?
  lastScheduledSession                    DateTime?
  gracePeriodEnds                         DateTime?
  recurringPatterns                       Json?
  package_redemptions                     package_redemptions[]
  package_transactions                    package_transactions[]
  users_student_packages_payerIdTousers   users                  @relation("student_packages_payerIdTousers", fields: [payerId], references: [id])
  users_student_packages_studentIdTousers users                  @relation("student_packages_studentIdTousers", fields: [studentId], references: [id])
  subjects                                subjects               @relation(fields: [subjectId], references: [id])
  teacher_profiles                        teacher_profiles       @relation(fields: [teacherId], references: [id])
  package_tiers                           package_tiers?         @relation(fields: [tierId], references: [id])

  @@index([payerId])
  @@index([status])
  @@index([studentId])
  @@index([teacherId])
  @@index([tierId])
}

model student_profiles {
  id              String            @id
  userId          String            @unique
  gradeLevel      String?
  bio             String?
  city            String?
  country         String?
  whatsappNumber  String?
  profilePhotoUrl String?
  schoolName      String?
  curriculumId    String?
  curricula       curricula?        @relation(fields: [curriculumId], references: [id])
  users           users             @relation(fields: [userId], references: [id], onDelete: Cascade)
  support_tickets support_tickets[]
}

model subjects {
  id                  String                @id
  nameAr              String
  nameEn              String
  isActive            Boolean               @default(true)
  bookings            bookings[]
  curriculum_subjects curriculum_subjects[]
  student_packages    student_packages[]
  teacher_subjects    teacher_subjects[]
}

model support_tickets {
  id                                            String                   @id
  readableId                                    String                   @unique
  createdByUserId                               String
  assignedToId                                  String?
  category                                      TicketCategory
  type                                          TicketType               @default(SUPPORT)
  priority                                      TicketPriority           @default(NORMAL)
  status                                        TicketStatus             @default(OPEN)
  linkedBookingId                               String?
  linkedTeacherId                               String?
  linkedStudentId                               String?
  subject                                       String
  description                                   String
  evidence                                      String[]                 @default([])
  escalationLevel                               EscalationLevel          @default(L1)
  slaDeadline                                   DateTime?
  slaBreach                                     Boolean                  @default(false)
  resolvedAt                                    DateTime?
  resolvedByUserId                              String?
  resolutionNote                                String?
  disputeId                                     String?                  @unique
  createdAt                                     DateTime                 @default(now())
  updatedAt                                     DateTime
  closedAt                                      DateTime?
  lastActivityAt                                DateTime                 @default(now())
  disputes                                      disputes?
  users_support_tickets_assignedToIdTousers     users?                   @relation("support_tickets_assignedToIdTousers", fields: [assignedToId], references: [id])
  users_support_tickets_createdByUserIdTousers  users                    @relation("support_tickets_createdByUserIdTousers", fields: [createdByUserId], references: [id])
  bookings                                      bookings?                @relation(fields: [linkedBookingId], references: [id])
  student_profiles                              student_profiles?        @relation(fields: [linkedStudentId], references: [id])
  teacher_profiles                              teacher_profiles?        @relation(fields: [linkedTeacherId], references: [id])
  users_support_tickets_resolvedByUserIdTousers users?                   @relation("support_tickets_resolvedByUserIdTousers", fields: [resolvedByUserId], references: [id])
  ticket_access_controls                        ticket_access_controls[]
  ticket_messages                               ticket_messages[]
  ticket_status_history                         ticket_status_history[]

  @@index([assignedToId])
  @@index([createdByUserId])
  @@index([escalationLevel, slaBreach])
  @@index([lastActivityAt])
  @@index([linkedBookingId])
  @@index([status, priority])
  @@index([type, status])
}

model system_settings {
  id                             String   @id @default("default")
  confirmationWindowHours        Int      @default(48)
  autoReleaseEnabled             Boolean  @default(true)
  reminderHoursBeforeRelease     Int      @default(6)
  defaultCommissionRate          Float    @default(0.18)
  createdAt                      DateTime @default(now())
  updatedAt                      DateTime
  disputeWindowHours             Int      @default(48)
  maxPricePerHour                Decimal  @default(50000) @db.Decimal(10, 2)
  defaultSessionDurationMinutes  Int      @default(60)
  allowedSessionDurations        Int[]    @default([60])
  meetingLinkAccessMinutesBefore Int      @default(15)
  allowedFileTypes               String[] @default(["image/jpeg", "image/png", "application/pdf"])
  currency                       String   @default("SDG")
  demosEnabled                   Boolean  @default(true)
  maintenanceMode                Boolean  @default(false)
  maxFileSizeMB                  Int      @default(10)
  minHoursBeforeSession          Int      @default(2)
  minWithdrawalAmount            Decimal  @default(500) @db.Decimal(10, 2)
  packagesEnabled                Boolean  @default(true)
  paymentWindowHours             Int      @default(24)
  supportEmail                   String   @default("support@sidra.com")
  timezone                       String   @default("Africa/Khartoum")
  maxVacationDays                Int      @default(21)
  searchConfig                   Json?
  cancellationPolicies           Json?
  depositBankName                String   @default("بنك الخرطوم")
  depositAccountHolderName       String   @default("عمر محمد عبدالرحيم عبيشي")
  depositAccountNumber           String   @default("1401733")
}

model teacher_demo_settings {
  id               String           @id
  teacherId        String           @unique
  demoEnabled      Boolean          @default(false)
  packagesEnabled  Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)
}

model teacher_package_tier_settings {
  id               String           @id
  teacherId        String
  tierId           String
  isEnabled        Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  package_tiers    package_tiers    @relation(fields: [tierId], references: [id], onDelete: Cascade)

  @@unique([teacherId, tierId])
  @@index([teacherId])
}

model teacher_profiles {
  id                             String                           @id
  userId                         String                           @unique
  bio                            String?
  averageRating                  Float                            @default(0)
  cancellationPolicy             CancellationPolicy               @default(FLEXIBLE)
  encryptedMeetingLink           String?
  gender                         Gender?
  hasCompletedOnboarding         Boolean                          @default(false)
  kycRejectionReason             String?
  kycStatus                      KYCStatus                        @default(PENDING)
  onboardingStep                 Int                              @default(0)
  totalReviews                   Int                              @default(0)
  totalSessions                  Int                              @default(0)
  yearsOfExperience              Int?
  displayName                    String?
  applicationStatus              ApplicationStatus                @default(DRAFT)
  changeRequestReason            String?
  fullName                       String?
  interviewLink                  String?
  interviewScheduledAt           DateTime?
  introVideoUrl                  String?
  profilePhotoUrl                String?
  rejectedAt                     DateTime?
  rejectionReason                String?
  reviewedAt                     DateTime?
  reviewedBy                     String?
  submittedAt                    DateTime?
  timezone                       String                           @default("UTC")
  termsAcceptedAt                DateTime?
  termsVersion                   String?
  city                           String?
  country                        String?
  dateOfBirth                    DateTime?
  idImageUrl                     String?
  idNumber                       String?
  idType                         IdType?
  slug                           String?                          @unique
  slugLockedAt                   DateTime?
  teachingStyle                  String?
  whatsappNumber                 String?
  isOnVacation                   Boolean                          @default(false)
  vacationEndDate                DateTime?
  vacationReason                 String?
  vacationStartDate              DateTime?
  availability                   availability[]
  availability_exceptions        availability_exceptions[]
  bank_info                      bank_info?
  bookings                       bookings[]
  demo_sessions                  demo_sessions[]
  documents                      documents[]
  interview_time_slots           interview_time_slots[]
  ratings                        ratings[]
  saved_teachers                 saved_teachers[]
  student_packages               student_packages[]
  support_tickets                support_tickets[]
  teacher_demo_settings          teacher_demo_settings?
  teacher_package_tier_settings  teacher_package_tier_settings[]
  users                          users                            @relation(fields: [userId], references: [id], onDelete: Cascade)
  teacher_qualifications         teacher_qualifications[]
  teacher_skills                 teacher_skills[]
  teacher_subjects               teacher_subjects[]
  teacher_teaching_approach_tags teacher_teaching_approach_tags[]
  teacher_work_experiences       teacher_work_experiences[]

  @@index([applicationStatus])
  @@index([isOnVacation])
}

model teacher_qualifications {
  id               String              @id
  teacherId        String
  degreeName       String
  institution      String
  fieldOfStudy     String?
  status           QualificationStatus @default(GRADUATED)
  startDate        DateTime?
  endDate          DateTime?
  graduationYear   Int?
  certificateUrl   String
  verified         Boolean             @default(false)
  verifiedAt       DateTime?
  verifiedBy       String?
  rejectionReason  String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles    @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
}

model teacher_skills {
  id               String           @id
  teacherId        String
  name             String
  category         SkillCategory?
  proficiency      SkillProficiency @default(INTERMEDIATE)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
}

model teacher_subject_grades {
  teacherSubjectId String
  gradeLevelId     String
  grade_levels     grade_levels     @relation(fields: [gradeLevelId], references: [id], onDelete: Cascade)
  teacher_subjects teacher_subjects @relation(fields: [teacherSubjectId], references: [id], onDelete: Cascade)

  @@id([teacherSubjectId, gradeLevelId])
}

model teacher_subjects {
  id                     String                   @id
  teacherId              String
  subjectId              String
  curriculumId           String
  pricePerHour           Decimal                  @db.Decimal(10, 2)
  teacher_subject_grades teacher_subject_grades[]
  curricula              curricula                @relation(fields: [curriculumId], references: [id])
  subjects               subjects                 @relation(fields: [subjectId], references: [id])
  teacher_profiles       teacher_profiles         @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
}

model teacher_teaching_approach_tags {
  teacherId              String
  tagId                  String
  createdAt              DateTime               @default(now())
  teaching_approach_tags teaching_approach_tags @relation(fields: [tagId], references: [id], onDelete: Cascade)
  teacher_profiles       teacher_profiles       @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@id([teacherId, tagId])
}

model teacher_work_experiences {
  id               String           @id
  teacherId        String
  title            String
  organization     String
  experienceType   ExperienceType
  startDate        DateTime?
  endDate          DateTime?
  isCurrent        Boolean          @default(false)
  description      String?
  subjects         String[]         @default([])
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_profiles teacher_profiles @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
  @@index([teacherId, isCurrent, startDate])
}

model teaching_approach_tags {
  id                             String                           @id
  labelAr                        String
  isActive                       Boolean                          @default(true)
  sortOrder                      Int                              @default(0)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  teacher_teaching_approach_tags teacher_teaching_approach_tags[]
}

model ticket_access_controls {
  id                                                  String          @id
  ticketId                                            String
  userId                                              String
  canView                                             Boolean         @default(true)
  canReply                                            Boolean         @default(true)
  canClose                                            Boolean         @default(false)
  canReopen                                           Boolean         @default(false)
  revokedAt                                           DateTime?
  revokedByUserId                                     String?
  revokedReason                                       String?
  createdAt                                           DateTime        @default(now())
  users_ticket_access_controls_revokedByUserIdTousers users?          @relation("ticket_access_controls_revokedByUserIdTousers", fields: [revokedByUserId], references: [id])
  support_tickets                                     support_tickets @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  users_ticket_access_controls_userIdTousers          users           @relation("ticket_access_controls_userIdTousers", fields: [userId], references: [id])

  @@unique([ticketId, userId])
  @@index([userId])
}

model ticket_messages {
  id                String          @id
  ticketId          String
  authorId          String
  content           String
  attachments       String[]        @default([])
  isInternal        Boolean         @default(false)
  isSystemGenerated Boolean         @default(false)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  deletedAt         DateTime?
  users             users           @relation(fields: [authorId], references: [id])
  support_tickets   support_tickets @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([ticketId, createdAt])
}

model ticket_status_history {
  id              String          @id
  ticketId        String
  fromStatus      TicketStatus?
  toStatus        TicketStatus
  changedByUserId String
  reason          String?
  createdAt       DateTime        @default(now())
  users           users           @relation(fields: [changedByUserId], references: [id])
  support_tickets support_tickets @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId, createdAt])
}

model transactions {
  id              String            @id
  walletId        String
  amount          Decimal           @db.Decimal(10, 2)
  type            TransactionType
  status          TransactionStatus @default(PENDING)
  referenceImage  String?
  adminNote       String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  bankSnapshot    Json?
  paidAt          DateTime?
  proofDocumentId String?
  readableId      String?           @unique
  referenceId     String?
  wallets         wallets           @relation(fields: [walletId], references: [id])

  @@index([status])
  @@index([type])
}

model users {
  id                                                                   String                   @id
  email                                                                String?                  @unique
  passwordHash                                                         String
  role                                                                 UserRole
  phoneNumber                                                          String                   @unique
  isActive                                                             Boolean                  @default(true)
  isVerified                                                           Boolean                  @default(false)
  createdAt                                                            DateTime                 @default(now())
  updatedAt                                                            DateTime
  requirePasswordChange                                                Boolean                  @default(false)
  createdByAdminId                                                     String?
  firstName                                                            String?
  lastName                                                             String?
  permissionOverrides                                                  Json?
  audit_logs                                                           audit_logs[]
  bookings_bookings_bookedByUserIdTousers                              bookings[]               @relation("bookings_bookedByUserIdTousers")
  bookings_bookings_studentUserIdTousers                               bookings[]               @relation("bookings_studentUserIdTousers")
  demo_sessions                                                        demo_sessions[]
  disputes_disputes_raisedByUserIdTousers                              disputes[]               @relation("disputes_raisedByUserIdTousers")
  disputes_disputes_resolvedByAdminIdTousers                           disputes[]               @relation("disputes_resolvedByAdminIdTousers")
  notifications                                                        notifications[]
  parent_profiles                                                      parent_profiles?
  ratings                                                              ratings[]
  refresh_tokens                                                       refresh_tokens[]
  reschedule_requests_reschedule_requests_requestedByIdTousers         reschedule_requests[]    @relation("reschedule_requests_requestedByIdTousers")
  reschedule_requests_reschedule_requests_respondedByIdTousers         reschedule_requests[]    @relation("reschedule_requests_respondedByIdTousers")
  saved_teachers                                                       saved_teachers[]
  student_packages_student_packages_payerIdTousers                     student_packages[]       @relation("student_packages_payerIdTousers")
  student_packages_student_packages_studentIdTousers                   student_packages[]       @relation("student_packages_studentIdTousers")
  student_profiles                                                     student_profiles?
  support_tickets_support_tickets_assignedToIdTousers                  support_tickets[]        @relation("support_tickets_assignedToIdTousers")
  support_tickets_support_tickets_createdByUserIdTousers               support_tickets[]        @relation("support_tickets_createdByUserIdTousers")
  support_tickets_support_tickets_resolvedByUserIdTousers              support_tickets[]        @relation("support_tickets_resolvedByUserIdTousers")
  teacher_profiles                                                     teacher_profiles?
  ticket_access_controls_ticket_access_controls_revokedByUserIdTousers ticket_access_controls[] @relation("ticket_access_controls_revokedByUserIdTousers")
  ticket_access_controls_ticket_access_controls_userIdTousers          ticket_access_controls[] @relation("ticket_access_controls_userIdTousers")
  ticket_messages                                                      ticket_messages[]
  ticket_status_history                                                ticket_status_history[]
  users                                                                users?                   @relation("usersTousers", fields: [createdByAdminId], references: [id])
  other_users                                                          users[]                  @relation("usersTousers")
  wallets                                                              wallets?
}

model wallets {
  id             String         @id
  userId         String         @unique
  balance        Decimal        @default(0) @db.Decimal(10, 2)
  pendingBalance Decimal        @default(0) @db.Decimal(10, 2)
  currency       String         @default("SDG")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  readableId     String?        @unique
  transactions   transactions[]
  users          users          @relation(fields: [userId], references: [id])
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  CHANGES_REQUESTED
  INTERVIEW_REQUIRED
  INTERVIEW_SCHEDULED
  APPROVED
  REJECTED
}

enum AuditAction {
  SETTINGS_UPDATE
  USER_BAN
  USER_UNBAN
  USER_VERIFY
  USER_REJECT
  DISPUTE_RESOLVE
  DISPUTE_DISMISS
  PAYOUT_PROCESS
  BOOKING_CANCEL
  REFUND_PROCESS
  PERMISSION_OVERRIDE_UPDATE
  ADMIN_USER_CREATED
  ADMIN_USER_DEACTIVATED
  TICKET_CREATED
  TICKET_UPDATED
  TICKET_CLOSED
  TICKET_REOPENED
  TICKET_ASSIGNED
  TICKET_ESCALATED
  TICKET_CONVERTED_TO_DISPUTE
  SUPPORT_TICKET_MESSAGE_ADDED
}

enum BeneficiaryType {
  CHILD
  STUDENT
}

enum BookingStatus {
  PENDING_TEACHER_APPROVAL
  WAITING_FOR_PAYMENT
  PAYMENT_REVIEW
  SCHEDULED
  COMPLETED
  REJECTED_BY_TEACHER
  CANCELLED_BY_PARENT
  CANCELLED_BY_ADMIN
  EXPIRED
  PENDING_CONFIRMATION
  DISPUTED
  REFUNDED
  PARTIALLY_REFUNDED
  CANCELLED_BY_TEACHER
}

enum CancellationPolicy {
  FLEXIBLE
  MODERATE
  STRICT
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum DemoOwnerType {
  PARENT
  STUDENT
}

enum DemoStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum DisputeStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED_TEACHER_WINS
  RESOLVED_STUDENT_WINS
  RESOLVED_SPLIT
  DISMISSED
}

enum DisputeType {
  TEACHER_NO_SHOW
  SESSION_TOO_SHORT
  QUALITY_ISSUE
  TECHNICAL_ISSUE
  OTHER
}

enum DocumentType {
  ID_CARD
  CERTIFICATE
  DEGREE
  OTHER
}

enum EmailStatus {
  PENDING
  PROCESSING
  SENT
  FAILED
}

enum EscalationLevel {
  L1
  L2
  L3
}

enum ExceptionType {
  ALL_DAY
  PARTIAL_DAY
}

enum ExperienceType {
  SCHOOL
  TUTORING_CENTER
  ONLINE_PLATFORM
  PRIVATE
  OTHER
}

enum Gender {
  MALE
  FEMALE
}

enum IdType {
  NATIONAL_ID
  PASSPORT
  DRIVER_LICENSE
  RESIDENT_PERMIT
}

enum KYCStatus {
  PENDING
  INFO_REQUIRED
  INTERVIEW_SCHEDULED
  APPROVED
  REJECTED
}

enum NotificationStatus {
  READ
  UNREAD
  ARCHIVED
}

enum NotificationType {
  BOOKING_REQUEST
  BOOKING_APPROVED
  BOOKING_REJECTED
  BOOKING_CANCELLED
  PAYMENT_SUCCESS
  PAYMENT_RELEASED
  ESCROW_REMINDER
  DEPOSIT_APPROVED
  DEPOSIT_REJECTED
  DISPUTE_UPDATE
  SYSTEM_ALERT
  DISPUTE_RAISED
  URGENT
  ADMIN_ALERT
  SESSION_REMINDER
  ACCOUNT_UPDATE
  BOOKING_RESCHEDULED
}

enum PackageSessionType {
  AUTO_SCHEDULED
  FLOATING
}

enum PackageStatus {
  ACTIVE
  DEPLETED
  COMPLETED
  EXPIRED
  CANCELLED
}

enum QualificationStatus {
  GRADUATED
  IN_PROGRESS
  NOT_COMPLETED
}

enum RedemptionStatus {
  RESERVED
  RELEASED
  CANCELLED
  REFUNDED
}

enum RescheduleRequestStatus {
  PENDING
  APPROVED
  DECLINED
  EXPIRED
}

enum SkillCategory {
  TEACHING_METHOD
  TECHNOLOGY
  SOFT_SKILL
  SUBJECT_SPECIFIC
}

enum SkillProficiency {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum SystemType {
  NATIONAL
  INTERNATIONAL
}

enum TicketCategory {
  ACADEMIC
  SESSION
  FINANCIAL
  TECHNICAL
  BEHAVIORAL
  GENERAL
}

enum TicketPriority {
  CRITICAL
  HIGH
  NORMAL
  LOW
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_FOR_CUSTOMER
  WAITING_FOR_SUPPORT
  RESOLVED
  CLOSED
  CANCELLED
}

enum TicketType {
  SUPPORT
  DISPUTE
}

enum TransactionStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT_LOCK
  PAYMENT_RELEASE
  REFUND
  CANCELLATION_COMPENSATION
  WITHDRAWAL_COMPLETED
  WITHDRAWAL_REFUNDED
  DEPOSIT_APPROVED
  PACKAGE_PURCHASE
  PACKAGE_RELEASE
  ESCROW_RELEASE
}

enum UserRole {
  PARENT
  STUDENT
  TEACHER
  ADMIN
  SUPPORT
  SUPER_ADMIN
  MODERATOR
  CONTENT_ADMIN
  FINANCE
}
